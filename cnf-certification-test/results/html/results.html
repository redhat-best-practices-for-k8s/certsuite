<!DOCTYPE html>
<html lang="en">

<head>
  <title>CNF Certification Test Results</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" integrity="sha256-2TnSHycBDAm2wpZmgdi0z81kykGPJAkiUY+Wf97RbvY=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" integrity="sha256-X0cPqbNml7z/f/z7c1HiTdJ2aSO4QmaAMDnESV5n7fE=" crossorigin="anonymous">

  <style>.accordion-button:not(.collapsed){background-color:#9935dc;color:#fff}.btn-purple.collapsed{color:#fff}li.dropdown-menu{background-color:#fff}tg{background-color:#28a745}tpurple,tred{background-color:#dc3545;color:#fff}.btn-purple.collapsed,tpurple{background-color:#9935dc}ty{background-color:#ffc107}tgy{background-color:#ced4da}tblack,tg,tgy,tpurple,tred,ty{font-size:25px}body{font-family:sans-serif}ul{list-style:none;padding-left:1.75em}ul li{border-bottom-left-radius:.75em;border-top-left-radius:.75em;margin:2px 0;position:relative}ul li a,ul li span{display:inline-block}ul li a{border-radius:50%;color:#000;height:1.5em;left:-1.5em;line-height:1.5em;position:absolute;text-align:center;text-decoration:none;width:1.5em}ul li a.plus{background-color:#77aeff}ul li a,ul li a.minus{background-color:#eee}ul li a:active{top:1px}ul li span{margin:.25em .5em}.top-right{font-size:small;position:fixed;right:1em;top:1em}progress{width:0%}input.larger-checkbox{width:25px;height:25px}</style>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.4/dayjs.min.js" integrity="sha256-NTsR4SOm3YHfJrmrmvBtEYqfQ6jQ5yvEKMhgQe3DIl0=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.4/plugin/duration.min.js" integrity="sha256-6rug74IKp6v/8WINJxMw33zXo8NVOdRw/5Ib21ZzwU4=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-0upsHgyryiDRjpJLJaHNAYfDi6fDP2CrBuGwQCubzbU=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/ansi_up@5.1.0/ansi_up.js" integrity="sha256-tarXJ7M5ReiY9qzPiDQdY5EZcrMil9PaXwnVbAgWbo8=" crossorigin="anonymous"></script>
  <script>const expectedClaimVersion="v0.1.0";let claimGlobal,feedbackGlobal,isResultTabActive=!1,uuidNode=1;function selectScenarioHandler(){!0===isResultTabActive&&resfreshResultsTabContent()}function resfreshResultsTabContent(){hideAllResultsTabObjects(),enableSendDownloadButton(),isResultTabActive=!0;const e=document.getElementById("selectScenarioComboBox");"all"===e.options[e.selectedIndex].value?showAll():(document.getElementById("results-table").setAttribute("hidden","hidden"),document.getElementById("myCheck-result").removeAttribute("hidden"),document.getElementById("optional-checkbox").removeAttribute("hidden"),document.getElementById("myCheck-mandatory").removeAttribute("hidden"),document.getElementById("mandatory-checkbox").removeAttribute("hidden")),makeResultsTableVisible("optional"),makeResultsTableVisible("mandatory")}function makeResultsTableVisible(e){const t=document.getElementById(e+"-checkbox"),n=document.getElementById("selectScenarioComboBox"),l=n.options[n.selectedIndex].value;"faredge"===l&&(!0===t.checked?document.getElementById(e+"-far-edge-table").removeAttribute("hidden"):document.getElementById(e+"-far-edge-table").setAttribute("hidden","hidden")),"telco"===l&&(!0===t.checked?document.getElementById(e+"-telco-table").removeAttribute("hidden"):document.getElementById(e+"-telco-table").setAttribute("hidden","hidden")),"nontelco"===l&&(!0===t.checked?document.getElementById(e+"-non-telco-table").removeAttribute("hidden"):document.getElementById(e+"-non-telco-table").setAttribute("hidden","hidden")),"extended"===l&&(!0===t.checked?document.getElementById(e+"-extended-table").removeAttribute("hidden"):document.getElementById(e+"-extended-table").setAttribute("hidden","hidden"))}function filterTestCasesBasedOnStateHandler(e,t,n,l){const o=document.getElementById("filter-"+l+"-"+n+"-"+t),a=o.checked;a?o.setAttribute("checked",""):o.removeAttribute("checked");const d=e.replace(/#/g,""),s=document.getElementById(d).getElementsByClassName("accordion-item");for(let e=0;e<s.length;e++){const t=s[e];t.getAttribute("data-id")===n&&(!0===a?t.removeAttribute("hidden"):t.setAttribute("hidden","hidden"))}}function showAll(){document.getElementById("mandatory-far-edge-table").setAttribute("hidden","hidden"),document.getElementById("mandatory-telco-table").setAttribute("hidden","hidden"),document.getElementById("mandatory-non-telco-table").setAttribute("hidden","hidden"),document.getElementById("mandatory-extended-table").setAttribute("hidden","hidden"),document.getElementById("optional-far-edge-table").setAttribute("hidden","hidden"),document.getElementById("optional-telco-table").setAttribute("hidden","hidden"),document.getElementById("optional-non-telco-table").setAttribute("hidden","hidden"),document.getElementById("optional-extended-table").setAttribute("hidden","hidden"),document.getElementById("results-table").removeAttribute("hidden")}function enableSendDownloadButton(){document.getElementById("download").removeAttribute("hidden"),document.getElementById("downloadjsonHandler").removeAttribute("hidden"),document.getElementById("UploadFeedback").removeAttribute("hidden")}function hideAllResultsTabObjects(){isResultTabActive=!1,document.getElementById("mandatory-far-edge-table").setAttribute("hidden","hidden"),document.getElementById("mandatory-non-telco-table").setAttribute("hidden","hidden"),document.getElementById("mandatory-extended-table").setAttribute("hidden","hidden"),document.getElementById("mandatory-telco-table").setAttribute("hidden","hidden"),document.getElementById("optional-far-edge-table").setAttribute("hidden","hidden"),document.getElementById("optional-non-telco-table").setAttribute("hidden","hidden"),document.getElementById("optional-extended-table").setAttribute("hidden","hidden"),document.getElementById("optional-telco-table").setAttribute("hidden","hidden"),document.getElementById("optional-checkbox").setAttribute("hidden","hidden"),document.getElementById("mandatory-checkbox").setAttribute("hidden","hidden"),document.getElementById("download").setAttribute("hidden","hidden"),document.getElementById("downloadjsonHandler").setAttribute("hidden","hidden"),document.getElementById("UploadFeedback").setAttribute("hidden","hidden"),document.getElementById("myCheck-result").setAttribute("hidden","hidden"),document.getElementById("myCheck-mandatory").setAttribute("hidden","hidden")}function fillVersionsElement(e,t){$(t).empty(),$('<thead><tr><th scope="col">Component</th><th scope="col">Version</th></tr></thead><tbody>').appendTo($(t));for(const n in e)$("<tr><td><b>"+n+"</b></td><td>"+e[n]+"</td></tr>").appendTo($(t));$("</tbody>").appendTo($(t))}function getClaimVersion(e){const t=e.claimFormat;if(void 0===t)return"nil - claimFormat version not present in claim file";const n=t.match(/(v[0-9]\.[0-9]\.[0-9])/);return null!==n&&n.length>1?n[1]:"nil - claimFormat version is not in a valid format, check claim file"}function fillMetadata(e,t){$(t).empty(),$("<tbody>").appendTo($(t));for(const n in e)$("<tr><td><b>"+n+"</b></td><td>"+e[n]+"</td></tr>").appendTo($(t));$("</tbody>").appendTo($(t))}$(document).ready((function(){"undefined"!=typeof initialjson&&(claimGlobal=initialjson),"undefined"!=typeof feedback&&(feedbackGlobal=feedback);const e=window.location.search,t=new URLSearchParams(e),n=t.get("claimfile"),l=t.get("feedback");console.log("claimfile via url:",n),console.log("feedbackfile via url:",l),fetchRenderClaimFile(n),fetchRenderFeedbackFile(l),void 0!==claimGlobal&&renderResultsWithModal();document.getElementById("feedbackFile").addEventListener("change",(function(){const e=this.files;if(e.length){const t=new FileReader;t.addEventListener("load",(e=>{fillFeedback(JSON.parse(t.result))})),t.readAsText(e[0])}this.value=null}),!1);document.getElementById("formFile").addEventListener("change",handleFiles,!1)}));const tableNameMap={faredge:"Far-Edge",telco:"Telco",nontelco:"Non-Telco",extended:"Extended",all:"All"};function getTestCaseStats(e,t){let n=0,l=0,o=0,a=0,d=0,s=0,c=0,i=0,r=0;for(const u in e){const m=e[u][0];let b=m.categoryClassification.FarEdge;"telco"===t&&(b=m.categoryClassification.Telco),"nontelco"===t&&(b=m.categoryClassification.NonTelco),"extended"===t&&(b=m.categoryClassification.Extended),"passed"===m.state?"Mandatory"===b||"all"===t?(n++,l++):s++:"skipped"===m.state?"Mandatory"===b||"all"===t?(n++,o++):c++:"failed"===m.state?"Mandatory"===b||"all"===t?(n++,a++):i++:"aborted"===m.state&&("Mandatory"===b||"all"===t?(n++,d++):r++)}return{testsTotal:n,testsPassed:l,testsSkipped:o,testsFailed:a,testsAborted:d,testsPassedOptional:s,testsSkippedOptional:c,testsFailedOptional:i,testsAbortedOptional:r}}function generateTestCasesStatsElement(e,t,n,l,o,a,d,s,c){let i="";return i="all"===t?'<thead><tr><th style="width:15%" scope="col">Test summary ('+tableNameMap[t]+')</th><th scope="col">Test feedback</th></tr></thead><tbody>':'<thead><tr><th style="width:15%" scope="col">'+n+" Test  summary ("+tableNameMap[t]+')</th><th scope="col">Test feedback</th></tr></thead><tbody>',i+='<tr><td class="align-top"><b><tblack>Total:</tblack></b><tblack> '+o+"</tblack><br><b><tg>Passed:</tg></b> <tblack>"+a+"</tblack> ",i+='<input type="checkbox" class="larger-checkbox" id="filter-'+n+"-passed-"+t+'" checked onclick="filterTestCasesBasedOnStateHandler(\''+e+"','"+t+"', 'passed','"+n+"' )\" >",i+="<br><b><tgy>Skipped:</tgy></b> <tblack>"+d+"</tblack> ",i+='<input type="checkbox" class="larger-checkbox" id="filter-'+n+"-skipped-"+t+'" checked onclick="filterTestCasesBasedOnStateHandler(\''+e+"','"+t+"', 'skipped', '"+n+"' )\" >",i+="<br><b><"+l+">Failed:</"+l+"></b> <tblack>"+s+"</tblack> ",i+='<input type="checkbox" class="larger-checkbox" id="filter-'+n+"-failed-"+t+'" checked onclick="filterTestCasesBasedOnStateHandler(\''+e+"','"+t+"', 'failed', '"+n+"' )\" >",i+="<br><b><tpurple>Aborted:</tpurple></b> <tblack>"+c+"</tblack> ",i+='<input type="checkbox" class="larger-checkbox" id="filter-'+n+"-aborted-"+t+'" checked onclick="filterTestCasesBasedOnStateHandler(\''+e+"','"+t+"', 'aborted', '"+n+"' )\" >",i+="</td><td>",i+='<div class="accordion" id="results-accordion">',i}function generateTestcaseSingleResultElement(e,t,n,l){const o=new AnsiUp;let a="";const d=e.state;let s="";"passed"===d?s="bg-success text-white":"skipped"===d?s="bg-dark-subtle text-black":"aborted"===d?s="btn-purple":(s="bg-warning text-white","Optional"===l&&"all"!==t||(s="bg-danger text-white"));const c="collapse"+n,i="heading"+n;a+='<div data-id="'+d+'" class="accordion-item"><h2 class="accordion-header" id="'+i+'"><button class="accordion-button collapsed '+s+'" type="button" data-bs-toggle="collapse" data-bs-target="#'+c+'" aria-expanded="true" aria-controls="'+c+'">',a+=e.testID.id+"</button></h2>",a+='<div id="'+c+'" class="accordion-collapse collapse" aria-labelledby="'+i+'">',a+='<div class="accordion-body" >',a+="<h1>Results</h1>",a+='<div class="table-responsive">',a+='<table id="myTable-'+e.testID.id+'" class="table table-bordered"><thead><tr>',a+="<th>Test ID</th>",a+='<th class="th-lg">Test Text</th>',a+="<th>Duration</th>",a+="<th>State</th>",a+="<th>Test output</th>",a+="</tr></thead><tbody>",dayjs.extend(window.dayjs_plugin_duration);const r=dayjs.duration(e.duration/1e6).format("D[d] H[h] m[m] s[s] SSS[ms]");let u="";"skipped"===e.state&&(u=e.failureReason,""===u&&(u="Test case skipped by configuration"),u=" ( "+u+" )"),a+='<tr><td  style="white-space: nowrap;">'+e.testID.id+"</td>",a+='<td class="th-lg">'+e.catalogInfo.description.replace(/\n/g,"<br>")+"</td>",a+="<td>"+r+"</td>",a+="<td><b>"+e.state+"</b>"+u+"</td>",a+="<td>"+o.ansi_to_html(ExtractLog(e.capturedTestOutput)).replace(/\n/g,"<br>")+"</td></tr>";const m=NonCompliantReasonTextToJson(e.capturedTestOutput),b=CompliantReasonTextToJson(e.capturedTestOutput);return a+="</tbody></table></div>",a+="<h1>Feedback</h1><label>Write your feedback for "+e.testID.id+" test case</label>",a+='<textarea style="width: 100%; margin: 0 auto;" rows = "5" id="source-'+t+"-"+e.testID.id+'" type="text"></textarea>',a+="<h1>Non-Compliant objects</h1>",a+=createReasonTableAllTypes(m),a+="<h1>Compliant objects</h1>",a+=createReasonTableAllTypes(b),a+="</div></div></div>",a}function fillResults(e,t,n,l){const o=Object.entries(e).sort((function(e,t){const n=e[1][0].testID.id+e[1][0].state,l=t[1][0].testID.id+t[1][0].state;return n.localeCompare(l)})),a=Object.fromEntries(o),d=getTestCaseStats(e,l);let s=generateTestCasesStatsElement(t,l,"mandatory","tred",d.testsTotal,d.testsPassed,d.testsSkipped,d.testsFailed,d.testsAborted),c=generateTestCasesStatsElement(n,l,"optional","ty",d.testsTotal,d.testsPassedOptional,d.testsSkippedOptional,d.testsFailedOptional,d.testsAbortedOptional),i=1;for(const t in a){const n=e[t][0];let o=n.categoryClassification.FarEdge;"telco"===l&&(o=n.categoryClassification.Telco),"nontelco"===l&&(o=n.categoryClassification.NonTelco),"extended"===l&&(o=n.categoryClassification.Extended),i+=1;const a=generateTestcaseSingleResultElement(n,l,i,o);"Mandatory"===o||"all"===l?s+=a:c+=a}s+="</div></td></tr></tbody>",c+="</div></td></tr></tbody>",$(s).appendTo($(t)),"all"!==l&&$(c).appendTo($(n))}function fillFeedback(e){for(const t in e){const n=document.getElementById(t);null!==n&&(n.textContent=n.value,n.textContent=e[t],n.value=e[t])}}function saveTextAreaContent(e){const t=document.getElementById("selectScenarioComboBox"),n="source-"+t.options[t.selectedIndex].value+"-"+e;console.log(n);const l=document.getElementById(n).value;document.getElementById(n).textContent=l}function handleFiles(){const e=this.files;if(e.length){const t=new FileReader;t.addEventListener("load",(e=>{claimGlobal=JSON.parse(t.result),renderResultsWithModal()})),t.readAsText(e[0])}}function renderResultsWithModal(){const e=getClaimVersion(claimGlobal.claim.versions),t=document.getElementById("modalBody");if(expectedClaimVersion!==e){$("#staticBackdrop").modal("show"),t.textContent="Unsupported claim format. Expecting: "+expectedClaimVersion+" but got: "+e;document.getElementById("continueLoadingClaim").addEventListener("click",renderResults)}else renderResults()}function fetchRenderClaimFile(e){null!==e&&fetch(e).then((e=>{if(!e.ok)throw new Error(`HTTP error, status = ${e.status}`);return e.json()})).then((e=>{claimGlobal=e,renderResultsWithModal()})).catch((e=>{console.log(`Error: ${e.message}`)}))}function fetchRenderFeedbackFile(e){null!==e&&fetch(e).then((e=>{if(!e.ok)throw new Error(`HTTP error, status = ${e.status}`);return e.json()})).then((e=>{feedbackGlobal=e,renderResultsWithModal()})).catch((e=>{console.log(`Error: ${e.message}`)}))}function renderResults(){if(void 0!==claimGlobal){let e=formatForFastTreeview(0,claimGlobal.claim.configurations,[]);addOrphans(e.objectArray,"#config-table"),e=formatForFastTreeview(0,claimGlobal.claim.nodes,[]),addOrphans(e.objectArray,"#nodes-table"),fillMetadata(claimGlobal.claim.metadata,"#metadata-table"),fillVersionsElement(claimGlobal.claim.versions,"#versions-table"),fillResults(claimGlobal.claim.results,"#results-table","#optional-","all"),fillResults(claimGlobal.claim.results,"#mandatory-far-edge-table","#optional-far-edge-table","faredge"),fillResults(claimGlobal.claim.results,"#mandatory-telco-table","#optional-telco-table","telco"),fillResults(claimGlobal.claim.results,"#mandatory-non-telco-table","#optional-non-telco-table","nontelco"),fillResults(claimGlobal.claim.results,"#mandatory-extended-table","#optional-extended-table","extended"),void 0!==feedbackGlobal&&fillFeedback(feedbackGlobal)}}function linkToStyle(e){const t=[],n=e.sheet;let l;try{l=n.cssRules||n.rules}catch(e){return console.log(e),null}for(let e=0;e<l.length;++e){const n=l[e];".collapse:not(.show)"!==l[e].selectorText&&t.push(n.cssText)}const o=document.createElement("style");return o.type="text/css",o.appendChild(document.createTextNode(t.join("\r\n"))),o}function getHtmlResults(){let e=document.getElementById("selectScenarioComboBox");const t=document.implementation.createHTMLDocument(),n=t.head,l=t.body,o=t.createElement("script");o.type="text/javascript",o.textContent="\n  function filterTestCasesBasedOnStateHandler(tableId, tableName, state, mandatoryOptional) { // eslint-disable-line no-unused-vars\n    const checkBox = document.getElementById('filter-' + mandatoryOptional + '-' + state + '-' + tableName)\n    const show = checkBox.checked\n    if (show) {\n      checkBox.setAttribute('checked', '')\n    } else {\n      checkBox.removeAttribute('checked')\n    }\n    const tableIdClean = tableId.replace(/#/g, '')\n    const table = document.getElementById(tableIdClean)\n    const elements = table.getElementsByClassName('accordion-item')\n    for (let i = 0; i < elements.length; i++) {\n      const element = elements[i]\n      const id = element.getAttribute('data-id')\n      if (id === state) {\n        if (show === true) {\n          element.removeAttribute('hidden')\n        } else {\n          element.setAttribute('hidden', 'hidden')\n        }\n      }\n    }\n  }\n",t.head.appendChild(o),e=document.getElementById("selectScenarioComboBox"),insertResults(l,"mandatory"),"all"!==e.value&&insertResults(l,"optional"),document.querySelectorAll("link[rel='stylesheet']").forEach((function(e){const t=linkToStyle(e);null!==t&&n.insertBefore(t,n.firstChild)})),document.querySelectorAll("style").forEach((function(e){const t=e.cloneNode(!0);n.insertBefore(t,n.firstChild)}));return t.querySelectorAll("textarea").forEach((e=>{e.readOnly=!0})),t.documentElement.outerHTML}function downloadjsonHandler(){const e={},t=["all","telco","nontelco","extended","faredge"];for(const n in claimGlobal.claim.results)for(let l=0;l<t.length;l++){const o="source-"+t[l]+"-"+n,a=document.getElementById(o);null!==a&&(e[o]=a.value)}const n=document.createElement("a");n.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e))),n.setAttribute("download","feedback.json"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function download(){for(const e in claimGlobal.claim.results)saveTextAreaContent(e);const e=document.createElement("a");e.setAttribute("href","data:text/html;charset=UTF-8,"+encodeURIComponent(getHtmlResults())),e.setAttribute("download","results-feedback"),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function insertResults(e,t){const n=document.getElementById(t+"-checkbox"),l=document.getElementById("selectScenarioComboBox").value;let o=document.getElementById("results-table");"faredge"===l&&!0===n.checked&&(o=document.getElementById(t+"-far-edge-table")),"telco"===l&&!0===n.checked&&(o=document.getElementById(t+"-telco-table")),"nontelco"===l&&!0===n.checked&&(o=document.getElementById(t+"-non-telco-table")),"extended"===l&&!0===n.checked&&(o=document.getElementById(t+"-extended-table"));const a=o.cloneNode(!0);e.appendChild(a)}function NonCompliantReasonTextToJson(e){const t=/NonCompliantObjectsOut":(\[.*])/.exec(e);let n;if(t){const e=t[1];n=JSON.parse(e)}return n}function CompliantReasonTextToJson(e){const t=/"CompliantObjectsOut":(\[.*]),"NonCompliantObjectsOut"/.exec(e);let n;if(t){const e=t[1];n=JSON.parse(e)}return n}function ExtractLog(e){const t=/(.*){"CompliantObjectsOut"/.exec(e);let n=e;return t&&(n=t[1]),n}function createTypeList(e){const t=new Map;return void 0===e||e.forEach((function(e){t.set(e.ObjectType,!0)})),t}function createReasonTableAllTypes(e){const t=createTypeList(e);let n="";return t.forEach((function(t,l){n+="<h2> Type: "+l+"</h2>",n+='<div class="table-responsive">',n+=createReasonTableOneType(e,l),n+="</div>"})),n}function createReasonTableOneType(e,t){if(void 0===e)return"";const n=document.createElement("table");n.setAttribute("border","1"),n.setAttribute("class","table table-striped");let l=!0;const o=document.createElement("tbody");return e.forEach((function(e){if(e.ObjectType!==t)return;if(l){const t=document.createElement("thead"),o=document.createElement("tr");null!==e.ObjectFieldsKeys&&Object.values(e.ObjectFieldsKeys).forEach((function(e){const t=document.createElement("th");t.textContent=e,o.appendChild(t)})),t.appendChild(o),n.appendChild(t),l=!1}const a=document.createElement("tr");null!==e.ObjectFieldsValues&&Object.values(e.ObjectFieldsValues).forEach((function(e){const t=document.createElement("td");t.textContent=e,a.appendChild(t)})),o.appendChild(a)})),n.appendChild(o),n.outerHTML}function isStringInt(e){return/^\d+$/.test(e)}function formatForFastTreeview(e,t,n){let l="",o="";for(const a in t){if(null===t[a]||"managedFields"===a)continue;"name"===a.toLowerCase()&&(l=t[a]),"namespace"===a.toLowerCase()&&(o=t[a]);const d=uuidNode++;if(Array.isArray(t[a])||"[object Object]"===t[a].toString()){const s=formatForFastTreeview(d,t[a],n),c=s.name,i=s.namespace;""!==c&&(l=c,o=i);let r=a;isStringInt(a)&&""!==l&&(r="ns:"+o+" name:"+l,l="",o=""),n.push({id:d.toString(),name:r,parent:e.toString()})}else n.push({id:d.toString(),name:a+" : "+t[a],parent:e.toString()})}return{objectArray:n,name:l,namespace:o}}function orphans(e){return e.filter((function(e){return"0"===e.parent}))}function hasChildren(e,t){return e.some((function(e){return e.parent===t}))}function getChildren(e,t){return e.filter((function(e){return e.parent===t}))}function generateListItem(e,t){const n=document.createElement("li");if(n.id="item-"+t.id,hasChildren(e,t.id)){const t=document.createElement("a");t.href="#",t.textContent="+",t.classList.add("plus"),t.title="hold shift to expand sub tree",t.addEventListener("click",expand.bind(null,e),{once:!0}),n.appendChild(t)}const l=document.createElement("span");return l.textContent=t.name,n.appendChild(l),n}function expand(e,t){t.preventDefault(),t.stopPropagation();const n=t.target,l=n.parentElement,o=l.id.replace("item-",""),a=getChildren(e,o).map(generateListItem.bind(null,e)),d=document.createElement("ul");if(a.forEach((function(e){d.appendChild(e)})),l.appendChild(d),n.classList.remove("plus"),n.classList.add("minus"),n.textContent="-",n.addEventListener("click",collapse.bind(null,e),{once:!0}),t.shiftKey){const t=countChildren(e,o,0);console.log(t),initProgressBar(),expandAll({value:d},t,{value:2})}}function collapse(e,t){t.preventDefault(),t.stopPropagation();const n=t.target,l=n.parentElement,o=l.querySelector("ul");l.removeChild(o),n.classList.remove("minus"),n.classList.add("plus"),n.textContent="+",n.addEventListener("click",expand.bind(null,e),{once:!0})}function addOrphans(e,t){const n=document.querySelector(t),l=orphans(e);if(l.length){const t=l.map(generateListItem.bind(null,e)),o=document.createElement("ul");t.forEach((function(e){o.appendChild(e)})),n.appendChild(o)}}function expandAll(e,t,n){if(isAnchorElement(e.value)){const t=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});e.value.dispatchEvent(t)}n.value++;updateProgressBar(100*n.value/t),e.value.children.length>0&&setTimeout((function(){for(let l=0;l<e.value.children.length;l++){expandAll({value:e.value.children[l]},t,n)}}),0)}function isAnchorElement(e){return e instanceof HTMLAnchorElement}function countChildren(e,t,n){const l=getChildren(e,t);return n++,l.length>0&&(n+=2),l.forEach((function(t){n=countChildren(e,t.id,n)+1})),n}function updateProgressBar(e){const t=document.querySelector(".progress-bar"),n=t.style.width.replace(/%/g,"");e>=parseInt(n)+2&&(t.style.width=e.toString()+"%")}function initProgressBar(){document.querySelector(".progress-bar").style.width="0%"}</script>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark">
    <a class="navbar-brand" href="#">CNF Certification Test Results</a>
    <div class="mb-3">
      <label for="formFile" class="form-label text-light">Upload claim.json file</label>
      <input class="form-control" type="file" id="formFile">
      <label for="selectScenarioComboBox" class="form-label text-light">
        Choose a scenario:</label>
      <select name="class" id="selectScenarioComboBox" onchange="selectScenarioHandler()">
        <option value="all"> All</option>
        <option value="faredge"> Far-Edge</option>
        <option value="telco"> Telco</option>
        <option value="nontelco"> Non-Telco</option>
        <option value="extended"> Extended</option>

      </select>
    </div>
  </nav>

  <button class="w3-button w3-right w3-light-grey" id="download" type="submit" onclick="download()" hidden>Download
    Results</button>

  <button class="w3-button w3-right w3-light-grey" id="downloadjsonHandler" type="submit" onclick="downloadjsonHandler()"
    hidden>Download Feedback as a JSON file</button>
  <p hidden id="UploadFeedback">
    Upload Feedback File: <input type="file" id="feedbackFile">
  </p>
  <div class="progress">
    <progress class="progress-bar" aria-label="progress" aria-valuenow="0" aria-valuemin="0"
      aria-valuemax="100"></progress>
  </div>
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button"
        role="tab" aria-controls="config" aria-selected="true" onclick="hideAllResultsTabObjects()">Configuration</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="metadata-tab" data-bs-toggle="tab" data-bs-target="#metadata" type="button"
        role="tab" aria-controls="metadata" aria-selected="false" onclick="hideAllResultsTabObjects()">Metadata</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="nodes-tab" data-bs-toggle="tab" data-bs-target="#nodes" type="button" role="tab"
        aria-controls="nodes" aria-selected="false" onclick="hideAllResultsTabObjects()">Nodes</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="result-tab" data-bs-toggle="tab" data-bs-target="#results" type="button" role="tab"
        aria-controls="nodes" aria-selected="false" onclick="resfreshResultsTabContent()">Results</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="versions-tab" data-bs-toggle="tab" data-bs-target="#versions" type="button"
        role="tab" aria-controls="versions" aria-selected="false" onclick="hideAllResultsTabObjects()">Versions</button>
    </li>

  </ul>
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" >
      <label id="myCheck-mandatory" for="mandatory-checkbox" hidden>Show Mandatory Results for that scenario</label>
      <input type="checkbox" id="mandatory-checkbox" data-bs-target="#results" checked
        onclick="makeResultsTableVisible('mandatory')" hidden>



      <label id="myCheck-result" for="optional-checkbox" hidden>Show Optional Results for that scenario</label>
      <input type="checkbox" id="optional-checkbox" data-bs-target="#results" 
        onclick="makeResultsTableVisible('optional')" hidden>


    </li>
  </ul>
  <div class="tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="config" role="tabpanel" aria-labelledby="config-tab">
      <div id="config-table">
      </div>
    </div>
    <div class="table-responsive tab-pane fade" id="metadata" role="tabpanel" aria-labelledby="metadata-tab">
      <table class="table" id="metadata-table">
      </table>
    </div>
    <div class="table-responsive tab-pane fade" id="nodes" role="tabpanel" aria-labelledby="nodes-tab">
      <table class="table" id="nodes-table">
      </table>
    </div>

    <div class="tab-pane fade table-responsive" id="results" role="tabpanel" aria-labelledby="result-tab">
      <table class="table" id="results-table" hidden>
      </table>
      <table class="table" id="mandatory-far-edge-table" hidden>
      </table>
      <table class="table" id="optional-far-edge-table" hidden>
      </table>
      <table class="table" id="mandatory-telco-table" hidden>
      </table>
      <table class="table" id="optional-telco-table" hidden>
      </table>
      <table class="table" id="mandatory-non-telco-table" hidden>
      </table>
      <table class="table" id="optional-non-telco-table" hidden>
      </table>
      <table class="table" id="mandatory-extended-table" hidden>
      </table>
      <table class="table" id="optional-extended-table" hidden>
      </table>
    </div>



    <div class="table-responsive tab-pane fade" id="versions" role="tabpanel" aria-labelledby="versions-tab">
      <table class="table" id="versions-table">
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Warning</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="modalBody">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Stop Loading</button>
          <button type="button" id="continueLoadingClaim" data-bs-dismiss="modal"
            class="btn btn-primary">Continue</button>
        </div>
      </div>
    </div>
  </div>


  <!-- This will load the initial JSON file, if present. It may fail. -->
  <script src="./claimjson.js"></script>
  <script src="./feedback.js"></script>

</body>

</html>
